# Configuring iOS DeviceCheck

To verify device integrity, Apple provides a service called [DeviceCheck][dc].
This service is most commonly used to store per-developer bits, but it can also
be used to verify the legitimacy of an iOS device.

As part of the DeviceCheck process, the server receives a `deviceToken` from a
verified iOS device. This token is generated by a client application see the
[DeviceCheck docs][dc] for information on how to generate this token in your
app. Note that the token is generated on the _client_. The _server_ does not
generate this token, but it does validate it's authenticity.

When the server receives the `deviceToken`, it needs to communicate with Apple's
servers to verify the authenticity of the token. This request requires
authentication and authorization. Authentication is provided via a signed JWT
and authorization is provided based on the grants given to the signing key. The
server automatically constructs and signs these JWTs, but you must provide the
signing keys.

Each _team_ requires a different key for verification. If you are running a
multi-tenant server that supports iOS apps from multiple developers, you will
need to acquire and register DeviceCheck for _each_ team.


## Getting the Team ID

The DeviceCheck API requires you to specify your Team ID. **This requires a
valid and active iOS Apple developer subscription.**

1.  Visit https://developer.apple.com/account/#/membership and sign in to your
    developer account.

1.  Find the value for "Team ID" in the table on this page - this is usually a
    10 character alpha-numeric ID like `ABCDE1FGHI`.


## Generating the DeviceCheck Private Key

In order for the server to communicate with Apple's servers, you will need to
create an Apple authenticate key with `DeviceCheck` enabled. **This requires a
valid and active iOS Apple developer subscription.**

1.  Visit https://developer.apple.com/account/resources and sign in to your
    developer account.

1.  Choose "Keys" in the side menu.

1.  Click the add button to create a new key.

1.  On the next page, enter a name for the key. This name is only for you to
    identify the key, so give it a descriptive name. You will not use the key
    name in later steps.

1.  Check the box next to "DeviceCheck" to enable using the DeviceCheck with
    this key.

1.  Click "Continue".

1.  On the success page, take **both** of the following actions:

    1.  Save the DeviceCheck Key ID value to a secure location - this is usually
        a 10 character alpha-numeric ID like `1BC2D3EFG4`.

    1.  Download the DeviceCheck Private Key file (`.p8`) and save it in a
        secure location. **This file is a private key, so treat it like a
        password.**


## Configuring DeviceCheck in the server

To enable and configure Apple's DeviceCheck on the server, you must specify the
following information for _each_ iOS application your server supports:

- **Team ID** - developer ID, used as the `iss` in the JWT.

- **Key ID** - key ID, used as the `kid` in the JWT.

- **Private Key** - private key (`.p8`), used to sign the JWT.


[dc]: https://developer.apple.com/documentation/devicecheck
